**Verification Process: Stage 2 Certification**

**Objective:** To formally verify that all core components planned for the current iteration/MVP of Stage 2 (Core Component Implementation) have been successfully built, reviewed, and meet the specifications defined in Stage 1. This process confirms the implemented code and templates are consistent, adhere to quality standards, align with the foundational plans, and provide a stable base for Stage 3 (Integration & Testing).

**Timing:** Execute this process *after* completing the planned iterations of TASKS 2.1 through 2.5 (covering the MVP or a significant feature set) and *before* initiating Stage 3 (TASK 3.1 onwards).

**Executor:** Solo Developer.

**Required Inputs:**

1. **All Stage 1 Artifacts:**
    * Project Plan.
    * Validated Requirements Summary (from TASK 1.1).
    * Finalized Pydantic Model Definitions (from TASK 1.2).
    * Jinja2 Template Structure Plan (from TASK 1.3).
    * Validation Logic Specification (from TASK 1.4).
2. **Stage 2 Outputs (Codebase):**
    * Implemented Python code for Pydantic models (`models/` or `schemas/`).
    * Implemented Python code for FastAPI endpoints (`routers/` or `main.py`).
    * Implemented Jinja2 template files (`templates/`).
    * Implemented Python code for Validation Logic (`utils/validation.py`).
    * Implemented Python code for Packaging Logic (`utils/packaging.py`).
    * Associated configuration files (e.g., for XSD paths).
    * Git commit history for Stage 2 work.

**Verification Method:** Use the following checklist. Review each item critically against the specified inputs and the actual codebase in its current state (e.g., latest commit on the development branch). Mark each item as Pass (✅) or Fail (❌). Add comments for any Failures.

**Verification Checklist: Stage 2 Outputs & Stage 1 Compatibility**

| Item ID | Category                 | Check                                                                                                                                                           | Criteria for Pass                                                                                                                                                                                                                         | Result (✅/❌) | Comments / Remediation Needed |
| :------ | :----------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----------: | :---------------------------- |
| **V2.1** | **Pydantic Code (2.1)**  | **Scope Implementation:** Does the implemented Pydantic code cover all models defined in the Stage 1 Spec (TASK 1.2) for the completed scope/MVP?                   | All specified models exist as Python code in the designated module(s).                                                                                                                                                                    |       ☐       |                               |
| **V2.2** | **Pydantic Code (2.1)**  | **Spec Compliance (Stage 1 Link):** Does the implemented code *accurately* reflect the fields, types, defaults, and validation logic defined in the Pydantic Spec (TASK 1.2)? | Spot checks confirm code matches the spec. Validators implement specified rules. Inheritance and nested models are correct.                                                                                                                |       ☐       |                               |
| **V2.3** | **Pydantic Code (2.1)**  | **HITL & Quality:** Was mandatory HITL review performed? Does the code pass configured linter/formatter checks (e.g., Ruff/Black)?                               | Self-attestation confirms review occurred. Running the linter/formatter on the relevant files shows no required changes.                                                                                                            |       ☐       |                               |
| **V2.4** | **FastAPI Code (2.2)**   | **Scope Implementation:** Does the implemented FastAPI code cover the endpoints planned for the completed scope/MVP?                                            | All specified endpoints exist in the routers/app code.                                                                                                                                                                                    |       ☐       |                               |
| **V2.5** | **FastAPI Code (2.2)**   | **Spec Compliance (Stage 1/2 Link):** Does endpoint code use correct paths, methods, request models (from TASK 2.1), specified error handling, and async usage?      | Code matches requirements. Request models link correctly to implemented Pydantic models. Error handling (4xx, 5xx, custom exceptions) is implemented as designed.                                                                             |       ☐       |                               |
| **V2.6** | **FastAPI Code (2.2)**   | **Integration Readiness:** Are calls to core logic (rendering, validation, packaging) clearly identifiable (even if placeholders)?                               | Code structure allows for replacing placeholders or calling implemented logic in Stage 3.                                                                                                                                                 |       ☐       |                               |
| **V2.7** | **FastAPI Code (2.2)**   | **HITL & Quality:** Was mandatory HITL review performed? Does the code pass linter/formatter checks?                                                           | Self-attestation confirms review. Linter/formatter passes.                                                                                                                                                                                |       ☐       |                               |
| **V2.8** | **Jinja2 Templates (2.3)** | **Scope Implementation:** Do the implemented Jinja2 templates cover the interactions, base files, and macros/includes planned for the completed scope/MVP?          | Required `.xml` files exist in the template directory structure.                                                                                                                                                                          |       ☐       |                               |
| **V2.9** | **Jinja2 Templates (2.3)** | **Structure Compliance (Stage 1 Link):** Do template file names and locations adhere to the Jinja2 Structure Plan (TASK 1.3)?                                     | Files are organized according to the plan.                                                                                                                                                                                                |       ☐       |                               |
| **V2.10**| **Jinja2 Templates (2.3)** | **Context Compliance (Stage 1/2 Link):** Do template variables (`{{ var }}`) correctly reference attributes from the corresponding Pydantic context models (TASK 2.1)? | Spot checks confirm variable names used in templates match field names in the relevant Pydantic code.                                                                                                                                   |       ☐       |                               |
| **V2.11**| **Jinja2 Templates (2.3)** | **Requirements Compliance (Stage 1 Link):** Do templates address key requirements (XML structure, namespaces, CDATA usage for MathML, filter calls)?              | Review confirms templates implement the specified XML structures and address technical requirements like CDATA wrapping and namespace handling (implicitly or explicitly).                                                                  |       ☐       |                               |
| **V2.12**| **Jinja2 Templates (2.3)** | **HITL & Validation:** Was critical HITL review performed, including rendering tests and `lxml` validation checks on sample outputs where feasible?               | Self-attestation confirms detailed review and validation attempts occurred. (Evidence of sample rendered XML + validation results is ideal).                                                                                                  |       ☐       |                               |
| **V2.13**| **Validation Code (2.4)**| **Implementation:** Does the validation function (`validate_xml`) exist in the codebase?                                                                       | The function is present in the designated utility module.                                                                                                                                                                                 |       ☐       |                               |
| **V2.14**| **Validation Code (2.4)**| **Spec Compliance (Stage 1 Link):** Does the function code *accurately* implement the Validation Logic Spec (TASK 1.4) regarding signature, `lxml`, caching, error handling? | Code review confirms function matches the spec precisely, especially caching logic and error log handling in the custom exception.                                                                                                         |       ☐       |                               |
| **V2.15**| **Validation Code (2.4)**| **HITL & Quality:** Was mandatory HITL review performed? Does the code pass linter/formatter checks?                                                           | Self-attestation confirms review. Linter/formatter passes.                                                                                                                                                                                |       ☐       |                               |
| **V2.16**| **Packaging Code (2.5)** | **Implementation:** Does the packaging function (`create_ims_package`) exist in the codebase?                                                                  | The function is present in the designated utility module.                                                                                                                                                                                 |       ☐       |                               |
| **V2.17**| **Packaging Code (2.5)** | **Requirements Compliance (Stage 1 Link):** Does the code meet packaging requirements (Plan Sec 8 / TASK 1.1) - manifest root, item/asset paths, compression?      | Code review confirms ZIP structure logic (manifest root, item placement, asset `arcname` usage) and compression match requirements.                                                                                                      |       ☐       |                               |
| **V2.18**| **Packaging Code (2.5)** | **HITL & Quality:** Was mandatory HITL review performed (including sample ZIP inspection)? Does the code pass linter/formatter checks?                            | Self-attestation confirms review and sample ZIP check. Linter/formatter passes.                                                                                                                                                           |       ☐       |                               |
| **V2.19**| **Overall Codebase**     | **Basic Integrity:** Does the application code appear runnable without obvious syntax errors or import failures (Static check)?                                 | IDE shows no major syntax errors; basic imports seem correct. (A quick local run attempt can confirm basic import resolution).                                                                                                            |       ☐       |                               |
| **V2.20**| **Overall Process**      | **Consistency:** Is naming consistent between Pydantic models, Jinja2 variables, and function calls/signatures across the implemented components?                  | Spot checks show consistent naming conventions.                                                                                                                                                                                           |       ☐       |                               |
| **V2.21**| **Overall Process**      | **Configuration:** Are necessary configurations (like XSD paths) handled via config files/env vars, not hardcoded?                                               | Configuration values are loaded externally as planned.                                                                                                                                                                                    |       ☐       |                               |
| **V2.22**| **Overall Process**      | **Version Control:** Is all implemented Stage 2 code committed to Git with reasonably descriptive messages?                                                    | `git status` is clean; `git log` shows commits for Stage 2 work.                                                                                                                                                                          |       ☐       |                               |

**Remediation Process:**

* If any checklist item is marked Fail (❌):
  * **STOP:** Do not proceed to Stage 3.
  * **Analyze:** Review the comments and understand the discrepancy (e.g., Pydantic code doesn't match spec V1.2, Jinja2 template variable uses wrong name V2.10, validation logic missed error handling from spec V1.4).
  * **Correct:** Go back to the relevant task(s) in Stage 2 (e.g., TASK 2.1, 2.3, 2.4). Implement the necessary fixes, ensuring they align with the Stage 1 specifications. This might involve re-prompting an agent with corrected context or making manual code changes, always followed by HITL review.
  * **Re-Verify:** Once corrections are made, re-execute this entire Verification Checklist from the beginning. Repeat until all items pass.

**Certification:**

* Once all checklist items are marked Pass (✅):
  * **Sign-off:** Formally record the successful completion of the Stage 2 Verification. Options:
    * Tag the commit in Git (e.g., `git tag stage-2-complete`).
    * Update status in project tracking tool.
    * Add dated entry to project README or log: `Stage 2 Verification completed and passed by [Your Name] on [Date]. Codebase implements Stage 1 specs for completed scope. Proceeding to Stage 3.`
  * **Proceed:** You are now certified to begin Stage 3: Integration & Testing.

---

This cumulative check ensures that Stage 2 didn't deviate from the plan laid out in Stage 1 and that the actual implementation meets the required quality standards before you invest time in integration and extensive testing in Stage 3. It reinforces the link between specification and implementation.
